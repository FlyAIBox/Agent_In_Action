# Langfuse å¿«é€Ÿå¼€å§‹æŒ‡å—

> 5 åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½² Langfuse å¤§æ¨¡åž‹è¯„ä¼°å¹³å°

---

## å‰ç½®å‡†å¤‡

ç¡®ä¿å·²å®‰è£…ï¼š
- Docker 20.10+
- Docker Compose 2.0+

```bash
# éªŒè¯å®‰è£…
docker --version
docker compose version
```

---

## å¿«é€Ÿéƒ¨ç½²ï¼ˆ3 æ­¥ï¼‰

### æ­¥éª¤ 1: ä¸‹è½½é…ç½®æ–‡ä»¶

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd 04-agent-evaluation/langfuse/docker

# æˆ–å…‹éš†å®˜æ–¹ä»“åº“
git clone https://github.com/langfuse/langfuse.git && cd langfuse
```

### æ­¥éª¤ 2: ç”Ÿæˆå®‰å…¨å¯†é’¥

```bash
# ä¸€é”®ç”Ÿæˆæ‰€æœ‰å¿…è¦å¯†é’¥
cat > .env << 'EOF'
# PostgreSQL
POSTGRES_PASSWORD=$(openssl rand -base64 24)

# ClickHouse
CLICKHOUSE_PASSWORD=$(openssl rand -base64 24)

# Encryption
ENCRYPTION_KEY=$(openssl rand -hex 32)

# Auth
NEXTAUTH_SECRET=$(openssl rand -base64 32)
SALT=$(openssl rand -base64 32)

# Redis
REDIS_AUTH=$(openssl rand -base64 24)

# MinIO
MINIO_ROOT_PASSWORD=$(openssl rand -base64 16)

# åˆå§‹ç®¡ç†å‘˜ï¼ˆå¯é€‰ï¼‰
LANGFUSE_INIT_USER_EMAIL=admin@example.com
LANGFUSE_INIT_USER_PASSWORD=$(openssl rand -base64 16)
LANGFUSE_INIT_USER_NAME=Admin
LANGFUSE_INIT_ORG_NAME=æˆ‘çš„ç»„ç»‡
LANGFUSE_INIT_PROJECT_NAME=æˆ‘çš„é¡¹ç›®
EOF

# æŸ¥çœ‹ç”Ÿæˆçš„é…ç½®
cat .env
```

**æˆ–è€…æ‰‹åŠ¨åˆ›å»º `.env` æ–‡ä»¶:**

```bash
# åˆ›å»º .env æ–‡ä»¶
nano .env
```

å¤åˆ¶ä»¥ä¸‹å†…å®¹å¹¶ä¿®æ”¹å¯†ç ï¼š

```bash
# æ•°æ®åº“å¯†ç ï¼ˆå¿…æ”¹ï¼‰
POSTGRES_PASSWORD=your_password_here
CLICKHOUSE_PASSWORD=your_password_here

# åŠ å¯†å¯†é’¥ï¼ˆå¿…æ”¹ï¼Œä½¿ç”¨: openssl rand -hex 32ï¼‰
ENCRYPTION_KEY=your_64_char_hex_key_here

# ä¼šè¯å¯†é’¥ï¼ˆå¿…æ”¹ï¼Œä½¿ç”¨: openssl rand -base64 32ï¼‰
NEXTAUTH_SECRET=your_secret_here

# ç›å€¼ï¼ˆå¿…æ”¹ï¼‰
SALT=your_salt_here

# Redis å¯†ç ï¼ˆå¿…æ”¹ï¼‰
REDIS_AUTH=your_redis_password

# MinIO å¯†ç ï¼ˆå¿…æ”¹ï¼Œè‡³å°‘ 8 ä½ï¼‰
MINIO_ROOT_PASSWORD=your_minio_password

# å¯é€‰ï¼šè‡ªåŠ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·
LANGFUSE_INIT_USER_EMAIL=admin@example.com
LANGFUSE_INIT_USER_PASSWORD=admin123456
LANGFUSE_INIT_USER_NAME=ç®¡ç†å‘˜
LANGFUSE_INIT_ORG_NAME=æˆ‘çš„ç»„ç»‡
LANGFUSE_INIT_PROJECT_NAME=æˆ‘çš„ç¬¬ä¸€ä¸ªé¡¹ç›®
```

### æ­¥éª¤ 3: å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d

# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
docker compose logs -f

# ç­‰å¾…çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰:
# langfuse-web-1 | Ready started server on 0.0.0.0:3000
```

**å®Œæˆï¼** ðŸŽ‰

è®¿é—®: **http://localhost:3000**

---

## èŽ·å– API å¯†é’¥

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:3000
2. ä½¿ç”¨é…ç½®çš„é‚®ç®±å¯†ç ç™»å½•ï¼ˆæˆ–æ³¨å†Œæ–°ç”¨æˆ·ï¼‰
3. è¿›å…¥ **Settings** â†’ **API Keys**
4. è®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **Public Key** (å…¬é’¥)
   - **Secret Key** (ç§é’¥)
   - **Host**: `http://localhost:3000`

---

## SDK é›†æˆç¤ºä¾‹

### Python SDK

```bash
# å®‰è£… SDK
pip install langfuse
```

```python
from langfuse import Langfuse

# åˆå§‹åŒ–å®¢æˆ·ç«¯
langfuse = Langfuse(
    public_key="pk-lf-...",      # æ›¿æ¢ä¸ºæ‚¨çš„å…¬é’¥
    secret_key="sk-lf-...",      # æ›¿æ¢ä¸ºæ‚¨çš„ç§é’¥
    host="http://localhost:3000" # æœ¬åœ°éƒ¨ç½²åœ°å€
)

# åˆ›å»ºè¿½è¸ª
trace = langfuse.trace(
    name="my-first-trace",
    user_id="user-123"
)

# è®°å½• LLM è°ƒç”¨
generation = trace.generation(
    name="chat-completion",
    model="gpt-4",
    input="ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±",
    output="æˆ‘æ˜¯ AI åŠ©æ‰‹ï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡..."
)

# ç»“æŸè¿½è¸ª
langfuse.flush()

print("è¿½è¸ªæˆåŠŸï¼è¯·è®¿é—® Langfuse UI æŸ¥çœ‹æ•°æ®")
```

### OpenAI SDK é›†æˆ

```bash
pip install langfuse openai
```

```python
from langfuse.openai import openai

# é…ç½® OpenAI å®¢æˆ·ç«¯ï¼ˆè‡ªåŠ¨è¿½è¸ªï¼‰
client = openai.OpenAI(
    api_key="your-openai-api-key"
)

# è®¾ç½® Langfuse å‡­è¯
import os
os.environ["LANGFUSE_PUBLIC_KEY"] = "pk-lf-..."
os.environ["LANGFUSE_SECRET_KEY"] = "sk-lf-..."
os.environ["LANGFUSE_HOST"] = "http://localhost:3000"

# æ­£å¸¸ä½¿ç”¨ OpenAIï¼Œè‡ªåŠ¨è¿½è¸ªåˆ° Langfuse
response = client.chat.completions.create(
    model="gpt-4",
    messages=[{"role": "user", "content": "ä½ å¥½"}]
)

print(response.choices[0].message.content)
# è‡ªåŠ¨è®°å½•åˆ° Langfuseï¼Œæ— éœ€é¢å¤–ä»£ç ï¼
```

### LangChain é›†æˆ

```bash
pip install langfuse langchain langchain-openai
```

```python
from langfuse.callback import CallbackHandler
from langchain_openai import ChatOpenAI
from langchain.chains import LLMChain
from langchain.prompts import PromptTemplate

# åˆ›å»º Langfuse å›žè°ƒå¤„ç†å™¨
langfuse_handler = CallbackHandler(
    public_key="pk-lf-...",
    secret_key="sk-lf-...",
    host="http://localhost:3000"
)

# åˆ›å»º LangChain é“¾
llm = ChatOpenAI(model="gpt-4")
prompt = PromptTemplate.from_template("è¯·ç”¨ä¸€å¥è¯ä»‹ç» {topic}")
chain = LLMChain(llm=llm, prompt=prompt)

# è¿è¡Œå¹¶è‡ªåŠ¨è¿½è¸ª
result = chain.run(
    topic="äººå·¥æ™ºèƒ½",
    callbacks=[langfuse_handler]
)

print(result)
# è¿½è¸ªæ•°æ®å·²è‡ªåŠ¨è®°å½•åˆ° Langfuseï¼
```

---

## å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f [æœåŠ¡å]

# åœæ­¢æœåŠ¡
docker compose down

# é‡å¯æœåŠ¡
docker compose restart

# åœæ­¢å¹¶åˆ é™¤æ•°æ®ï¼ˆå±é™©ï¼ï¼‰
docker compose down -v

# æ›´æ–°é•œåƒ
docker compose pull
docker compose up -d
```

---

## è®¿é—®ç®¡ç†ç•Œé¢

### Langfuse Web UI
- **åœ°å€**: http://localhost:3000
- **åŠŸèƒ½**: è¿½è¸ªæ•°æ®æŸ¥çœ‹ã€æç¤ºè¯ç®¡ç†ã€è¯„ä¼°åˆ†æž

### MinIO æŽ§åˆ¶å°
- **åœ°å€**: http://localhost:9091
- **ç”¨æˆ·å**: `minio`
- **å¯†ç **: `.env` ä¸­çš„ `MINIO_ROOT_PASSWORD`
- **åŠŸèƒ½**: å¯¹è±¡å­˜å‚¨ç®¡ç†ã€åª’ä½“æ–‡ä»¶æŸ¥çœ‹

---

## æ•…éšœæŽ’æŸ¥

### æ— æ³•è®¿é—® Web ç•Œé¢

```bash
# 1. æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
docker compose ps

# 2. æŸ¥çœ‹ Web æœåŠ¡æ—¥å¿—
docker compose logs langfuse-web

# 3. æ£€æŸ¥ç«¯å£å ç”¨
sudo lsof -i :3000

# 4. é‡å¯æœåŠ¡
docker compose restart langfuse-web
```

### æ•°æ®åº“è¿žæŽ¥å¤±è´¥

```bash
# 1. æ£€æŸ¥ PostgreSQL çŠ¶æ€
docker compose ps postgres

# 2. æµ‹è¯•æ•°æ®åº“è¿žæŽ¥
docker compose exec postgres psql -U postgres -c "SELECT 1;"

# 3. æ£€æŸ¥å¯†ç é…ç½®
cat .env | grep POSTGRES_PASSWORD

# 4. é‡å¯æ‰€æœ‰æœåŠ¡
docker compose restart
```

### å¯åŠ¨æ—¶é—´è¿‡é•¿

```bash
# é¦–æ¬¡å¯åŠ¨éœ€è¦åˆå§‹åŒ–æ•°æ®åº“ï¼ˆ3-5 åˆ†é’Ÿï¼‰
# æŸ¥çœ‹åˆå§‹åŒ–è¿›åº¦
docker compose logs langfuse-worker | grep migration

# å¦‚æžœè¶…è¿‡ 10 åˆ†é’Ÿï¼Œæ£€æŸ¥èµ„æºä½¿ç”¨
docker stats

# ç¡®ä¿æœºå™¨é…ç½®æ»¡è¶³æœ€ä½Žè¦æ±‚ï¼š
# - CPU: 4 æ ¸
# - å†…å­˜: 8GB
# - ç£ç›˜: 100GB
```

---

## ä¸‹ä¸€æ­¥

- ðŸ“– é˜…è¯»å®Œæ•´çš„ [éƒ¨ç½²æŒ‡å—.md](./éƒ¨ç½²æŒ‡å—.md)
- ðŸ”’ é…ç½® [å®‰å…¨åŠ å›º](#) (ç”Ÿäº§çŽ¯å¢ƒå¿…è¯»)
- ðŸ“Š å­¦ä¹  [Langfuse å®˜æ–¹æ–‡æ¡£](https://langfuse.com/docs)
- ðŸŽ“ æŽ¢ç´¢ [è¯„ä¼°æœ€ä½³å®žè·µ](https://langfuse.com/guides)

---

## èŽ·å–å¸®åŠ©

- **GitHub**: https://github.com/langfuse/langfuse/issues
- **Discord**: https://discord.gg/7NXusRtqYU
- **æ–‡æ¡£**: https://langfuse.com/docs

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ðŸš€

