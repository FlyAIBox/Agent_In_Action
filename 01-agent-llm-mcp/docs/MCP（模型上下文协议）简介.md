# MCP（模型上下文协议）简介

![什么是MCP](https://cdn.jsdelivr.net/gh/Fly0905/note-picture@main/imag/202510131655443.PNG)

模型上下文协议（Model Context Protocol，MCP）是一个标准化的接口和框架，允许 AI 模型（如大型语言模型 LLMs）与外部工具、资源和环境**无缝交互**。
 它的作用类似于 **USB-C** —— 为 AI 系统连接到各种功能（工具、数据源等）提供了一个**通用连接器**。

------

## 一、MCP 的创建目的（The Problem and The Solution）

### 1. 创建原因

LLMs 拥有出色的知识和推理能力，但其知识仅限于初始训练数据。
 当它们需要访问**实时信息**或执行**外部操作**时，必须借助外部工具和资源。

------

### 2. 传统问题：M×N 集成问题

在 MCP 出现之前，将 AI 应用连接到外部工具需要**定制化、一次性**的集成方案。
 若有 **M 个 AI 应用**与 **N 个工具/数据源**，则需编写 **M×N 个不同的集成模块** ——
 这显然**难以扩展**。

------

### 3. MCP 的解决方案：M+N 实现

MCP 通过引入一个**标准接口**解决上述问题。

- 每个 **AI 应用（M）** 只需实现一次 **MCP 客户端（Client）**；
- 每个 **工具（N）** 只需实现一次 **MCP 服务器（Server）**。

这样，所有组件都能“说同一种语言”，极大地**简化了连接**。
 就像有了一个**通用翻译器**，让只会英语的你能与各种语言的使用者（工具）交流。

------

## 二、MCP 架构概览

MCP 采用 **客户端-服务器（Client–Server）** 架构，
 但在 AI 上下文中包含三个主要角色：

------

### 1. Host（主机）

**定义：** 面向用户的 AI 应用，是 AI 模型运行并与用户交互的地方。

**职责：**

- 捕获用户输入
- 维护对话历史
- 显示模型回复
- 在需要时连接到 MCP 服务器

**示例：**
 Anthropic 的 **Claude Desktop**、AI 增强的 **IDE（如 Cursor）**，或任意嵌入 AI 助手的应用。

------

### 2. Client（客户端）

**定义：** 位于 Host 内部的组件，负责与 MCP Server 进行**底层通信**。

**职责：**
 充当 **适配器或信使** —— Host 决定“要做什么”， Client 负责“如何用 MCP 协议执行”。

------

### 3. Server（服务器）

**定义：** 提供功能（工具、数据等）的外部程序或服务。

**职责：**
 将外部功能（如数据库、Web API、本地文件系统）以**标准化方式暴露**给 MCP Client 调用。

**运行位置：**
 既可在本地运行，也可部署在远程云端。

------

## 三、MCP 的核心功能：工具、资源与提示

工具（Tools）、资源（Resources）和提示（Prompts）构成 MCP 的三大核心能力（Capabilities），
 是服务器向客户端（AI 应用）提供的功能接口。

------

### 1. 工具（Tools）

**定义：**
 可执行的动作或函数，AI（Host/Client）可以调用。
 通常涉及 **外部 API 调用或带副作用的操作**（如文件 I/O、网络请求）。

**特点：**

- **控制权：** 由 AI 模型（经 Host）决定何时调用。
- **安全性：** 具有强大执行力，调用前通常需**用户授权**。
   例如，Claude 客户端可能弹窗提示：“AI 想使用 ‘get_weather’ 工具，是否允许？”
- **输出：** 返回**结构化数据**（如字典或 JSON 对象），供 AI 使用。

**示例：**
 `get_weather(location: str)` → 返回当前温度与天气状况。

------

### 2. 资源（Resources）

**定义：**
 为 AI 模型提供的**只读数据源（Read-only Data Sources）**。

**特点：**

- 无副作用，仅作信息查阅。
- 通常在 **Host 应用控制下访问**，而非由模型主动请求。
- 可作为 AI 的**上下文**或知识库。

**常见用途：**
 提供文件内容、知识库片段、数据库查询结果（只读）或系统配置等。

**标识方式：**
 通过 **URI** 或 **名称（Name）** 识别。

------

### 3. 提示（Prompts）

**定义：**
 预定义的**提示模板**或**会话流程**，用于指导 AI 的行为。

**作用：**
 提供**现成指令或模板**，可在不修改客户端的情况下更新 AI 行为。
 如：设定系统角色为“你是一个代码审查员”。

**特点：**

- 通常由**用户或开发者控制**，非模型自发调用。
- 用于交互开始时**设定场景或上下文**。



> 模型上下文协议（MCP）通过**统一标准接口**实现了 AI 与外部系统的高效连接，
>  将复杂的 M×N 集成问题转化为可扩展的 M+N 模型。
>  其核心能力 —— 工具、资源与提示 —— 构成了 AI 系统**具备可扩展性与可操作性**的基础。

## 四、 MCP工具调用流程

![MCP流程](https://cdn.jsdelivr.net/gh/Fly0905/note-picture@main/imag/202510131655153.PNG)

这是一个关于 **模型上下文协议（Model Context Protocol，MCP）** 如何让 **AI 模型（LLM）调用外部工具** 的流程图。
 整个流程基于 MCP 的 **客户端-服务器（Client–Server）架构**，包含 **Host**、**Client** 和 **Server** 三个关键组件。

------

### MCP 工具调用流程概览

该图解展示了当用户发起查询后，MCP 如何协调 **LLM** 与 **MCP 工具** 的交互，最终生成响应的 **10 个步骤**：

1. **用户输入（Input）**
    用户（User）向 **MCP Host** 发送一个查询（Query）。
2. **选择工具（Select MCP tool）**
    查询首先进入 **MCP Client**。
    Client 将查询发送给 **LLM**（例如 Deepseek）。
    LLM 根据查询内容，决定需要调用哪个 **MCP 工具**。
3. **返回工具信息（Return MCP tool）**
    LLM 将选定的工具信息返回给 **MCP Client**。
4. **工具批准（MCP Tool approval）**
    由于工具通常涉及外部操作，**MCP Client** 会向用户请求**工具调用批准**。
5. **请求工具调用（Request tool call）**
    一旦获得用户批准，**MCP Client** 向 **MCP Server** 发送工具调用请求（Input）。
6. **调用工具（Invoke MCP tool）**
    **MCP Server** 接收请求，并实际执行相应的 **MCP Tool**。
7. **工具输出（Tool Output）**
    MCP Tool 完成任务，生成输出结果。
8. **返回输出（Return output）**
    **MCP Server** 将 **Tool Output** 返回给 **MCP Client**。
9. **发送输出和查询（Send output and query to LLM）**
    **MCP Client** 将工具输出结果及原始查询一起发送回 **LLM**。
10. **生成响应（Generate）**
     **LLM** 使用工具返回的**上下文信息**生成最终的 **LLM Response（回复）** 给用户。

------

### 关键组件及其在 MCP 架构中的角色

| 组件                      | 角色定位（MCP Architecture）                     | 在流程中的主要作用                                           |
| ------------------------- | ------------------------------------------------ | ------------------------------------------------------------ |
| **MCP Host**（如 Claude） | **用户界面（User-facing AI application）**       | 接收**用户输入** (1)，是 **Client** 所在的环境，并最终向用户显示 **LLM Response** (10)。 |
| **LLM**（如 Deepseek）    | **AI 模型（AI Model）**                          | 根据用户查询**推理**并**选择**所需工具 (2)，并使用**工具输出**生成最终回复 (10)。 |
| **MCP Client**            | **适配器／信使（Adapter / Messenger）**          | 充当协调者：将查询转发给 LLM (2)，接收工具信息 (3)，请求**用户批准** (4)，并向 Server **发起工具调用** (5)。 |
| **MCP Server**            | **功能提供者（External Program / Service）**     | 接收 Client 的调用请求 (5)，**调用**实际的 **MCP Tool** (6)，并将**工具输出** (7) 返回给 Client (8)。 |
| **MCP Tool**              | **可执行动作（Executable Actions / Functions）** | 封装外部功能（例如 Web API、数据库操作），在 Server 侧被**实际执行** (6)，生成 LLM 所需的外部数据。 |

